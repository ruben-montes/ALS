/*!
 * 
 *     MCAFEE RESTRICTED CONFIDENTIAL
 *     Copyright (c) 2025 McAfee, LLC
 *
 *     The source code contained or described herein and all documents related
 *     to the source code ("Material") are owned by McAfee or its
 *     suppliers or licensors. Title to the Material remains with McAfee
 *     or its suppliers and licensors. The Material contains trade
 *     secrets and proprietary and confidential information of McAfee or its
 *     suppliers and licensors. The Material is protected by worldwide copyright
 *     and trade secret laws and treaty provisions. No part of the Material may
 *     be used, copied, reproduced, modified, published, uploaded, posted,
 *     transmitted, distributed, or disclosed in any way without McAfee's prior
 *     express written permission.
 *
 *     No license under any patent, copyright, trade secret or other intellectual
 *     property right is granted to or conferred upon you by disclosure or
 *     delivery of the Materials, either expressly, by implication, inducement,
 *     estoppel or otherwise. Any license under such intellectual property rights
 *     must be expressed and approved by McAfee in writing.
 *
 */(()=>{"use strict";const e="TI_REQUEST",t="NATIVE_TELEMETRY",s="PING_CONTENT_SEARCH_CATEGORIZATION",n=0,r="PRINT_IN_BACKGROUND",o={NONE:0,INFO:1,ERROR:2,WARN:3,DEBUG:4,ALL_IN_BACKGROUND:99},i=1,a=2,c=3,l=4,h={BACKGROUND:"BACKGROUND",CONTENT:"CONTENT",TELEMETRY:"TELEMETRY"},u={DEFAULT:"color: #000000; font-weight: normal; font-style:normal; background: #FFFFFF;",BACKGROUND:"color: #8D0DBA; font-weight: bold; background: #FFFFFF;",CONTENT:"color: #F54A26; font-weight: bold; background: #FFFFFF;",TELEMETRY:"color: #147831; font-weight: bold; background: #FFFFFF;"};const d=new class{constructor(){this.storageChecked=!1,this.logLevel=null,this.queue=[];const e="MCLOGLEVEL";chrome?.storage?.local.get([e]).then(t=>{const s=Object.values(o).includes(t[e]);this.logLevel=s?t[e]:n,this.logLevel!==o.NONE&&this.queue.forEach(({callback:e,message:t,processType:s})=>{e(t,s)}),this.queue=[],this.storageChecked=!0})}log(e,t=null){this.storageChecked?this.processLog(e,i,t,this.logLevel):this.queue.push({callback:this.log.bind(this),message:e,processType:t})}error(e,t=null){this.storageChecked?this.processLog(e,a,t,this.logLevel):this.queue.push({callback:this.error.bind(this),message:e,processType:t})}warn(e,t=null){this.storageChecked?this.processLog(e,c,t,this.logLevel):this.queue.push({callback:this.warn.bind(this),message:e,processType:t})}debug(e,t=null){this.storageChecked?this.processLog(e,l,t,this.logLevel):this.queue.push({callback:this.debug.bind(this),message:e,processType:t})}processLog(e,t,s,n){if(n===o.NONE)return;let i="chrome-extension:"===location.protocol?h.BACKGROUND:h.CONTENT;s&&h[s]&&(i=s);const c=this.formatDateWithMilliseconds(new Date),l=t===a?e:`%c[${i} ${c} ]: %c${e}`;i===h.CONTENT&&this.logLevel===o.ALL_IN_BACKGROUND&&chrome.runtime.sendMessage({command:r,logMessage:l,processType:i,logType:t,logLevel:n}),this.printLog(l,i,t,n)}formatDateWithMilliseconds(e){return`${new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(e)}.${e.getMilliseconds().toString().padStart(3,"0")}`}printLog(e,t,s,n){const r=u.DEFAULT,h=u[t]||r;if(n>=o.ERROR&&s===a&&console.error(e),n>=o.INFO&&s===i&&console.log(e,h,r),n>=o.WARN&&s===c){const t="color: #FFA500; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cWARN - ${e}`,t,h,r)}if(n>=o.DEBUG&&s===l){const t="color: #FF33D7; font-family: sans-serif; font-weight: bolder; text-shadow: #000 1px 1px;";console.log(`%cDEBUG - ${e}`,t,h,r)}}},g=async(e,t,s,n)=>{try{chrome.tabs.sendMessage(n,{ipcId:e,command:t,...s},{},()=>{chrome.runtime.lastError})}catch(e){d.warn(`[broadcast] Unexpected error when calling command: "${t}", err: ${e.message}`)}},m=(e,t,s,n,r=null)=>{if(!chrome.tabs)throw new Error('"tabs" permission not set in manifest.');const o={};return"number"==typeof r&&(o.frameId=r),chrome.tabs.sendMessage(n,{ipcId:e,command:t,...s},o)},p=(e,t={},s)=>(async(e,t,s={},n={})=>{try{if(n?.tabId){const{tabId:r,frameId:o}=n;return await m(e,t,s,r,o)}if(n?.broadcast){const r=await chrome.tabs.query({}),{broadcastIgnoreId:o=[]}=n;return r.filter(({id:e})=>!o.includes(e)).forEach(({id:n})=>{g(e,t,s,n)}),!0}return await chrome.runtime.sendMessage({ipcId:e,command:t,...s})}catch(e){return d.warn(`Unexpected error when calling command: "${t}", err: ${e.message}`),null}})("WA",e,t,s),E=e=>{"undefined"!=typeof document&&null!==document&&("complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e))};class y{constructor(e,t){this.pingCommand=e,this.ipcId=t,this.mainFunction="function"==typeof this.main?((e,t)=>{let s;return(...n)=>(e&&(s=e.apply(t||void 0,n),e=null,t=null),s)})(this.main,this):()=>{},this.basePingListener(),this.addIdentifier()}basePingListener(){((e,t=null,s)=>{"function"==typeof s?chrome.runtime.onMessage.addListener((n,r,o)=>{if(r.id===chrome.runtime.id&&"object"==typeof n&&!Array.isArray(n)&&n?.ipcId===e)return s({promises:t,request:n,sender:r,sendResponse:o})}):d.error("Provided with invalid callback function")})(this.ipcId,null,({request:e,sendResponse:t})=>{const{command:s,...n}=e;if(s===this.pingCommand)return d.debug(`File Injection [pinged]: Received ${s} command`),t({content:!0}),"function"==typeof this.mainFunction&&this.mainFunction(n),"function"==typeof this.callback&&this.callback(),!0})}addIdentifier(){E(()=>{const e=document.createElement("span");e.id=this.pingCommand,e.style.cssText="display:none",document.body.appendChild(e)})}}const f={NONE:0,LINKEDIN:1,INSTAGRAM:2,YOUTUBE:4,FACEBOOK:8,TWITTER:16,REDDIT:32},N=(Object.values(f).reduce((e,t)=>e+t),{NONE:"NONE",ONLY_SECURE_SEARCH:"ONLY_SECURE_SEARCH",ALL:"ALL",*[Symbol.iterator](){for(const e of Object.keys(this))yield e}}),{NONE:T,...b}=f,R={name:"FINGER_PRINT",type:"number"},L={name:"FIRST_PARTY",type:"number"},C={name:"THIRD_PARTY",type:"number"},F=chrome,A=(Symbol.iterator,(e,t)=>Array.from(Array(t+1).keys()).slice(e)),O=(F.runtime.getURL(""),R.name,L.name,C.name,"SearchCategorization");A(48,57),A(65,90),A(96,107),A(109,111),A(186,192),A(219,222);new class extends y{constructor(){super(s,"WA"),this.searchEngine="unknown",this.isSecureSearch=!1}async main(e){const{searchEngine:t,isSecureSearch:s=!1}=e;this.searchEngine=t||"unknown",this.isSecureSearch=s,this.searchEngine&&"unknown"!==this.searchEngine&&E(()=>{this.categorizeSearchResults()})}async categorizeSearchResults(){try{const e=await this.getTopSearchResults(5);if(0===e.length)return void d.log("No top search results found");d.log(`Top 5 search result URLs: ${JSON.stringify(e,null,2)}`);const t=await this.requestCategories(e),s=this.buildCategoryCounts(t,e);d.log(`Search result category counts: ${JSON.stringify(s)}`),this.sendCategoryTelemetry(s)}catch(e){d.error(`Error categorizing search results: ${e}`)}}async getTopSearchResults(e=5){const t=[];let s=[];const n=await((e,t,s)=>{const n=async(t,r)=>{await s()?r(!0):t<=0?r(!1):setTimeout(()=>{n(t-1,r)},e)};return new Promise(e=>{n(t,e)})})(500,4,()=>(s=document.querySelectorAll('a[wa-annotate="true"]'),s.length>0));if(!n)return[];for(const n of s){if(t.length>=e)break;const{href:s}=n;s&&(s.startsWith("http://")||s.startsWith("https://"))&&!t.includes(s)&&t.push(s)}return t}async requestCategories(t){try{return await p(e,{requestData:t,referer:null})}catch(e){return d.error(`Error requesting categories from TI: ${e}`),null}}buildCategoryCounts(e,t){const s={};return e&&e.annotationMap?(t.forEach(t=>{const n=e.annotationMap[t];n&&n.category&&Array.isArray(n.category)&&n.category.forEach(e=>{e&&(s[e]=(s[e]||0)+1)})}),s):s}sendCategoryTelemetry(e){const s={identifier:O,isFromBackground:!0,searchEngine:this.searchEngine,isSecureSearch:this.isSecureSearch,categoriesCounts:e};d.log(`Sending category telemetry: ${JSON.stringify(s)}`),p(t,s)}}})();
//# sourceMappingURL=../sourceMap/chrome/scripts/content_search_categorization.js.map